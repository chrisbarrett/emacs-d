# org

Org-mode core configuration with visual enhancements, evil integration, and custom workflows.

## Files

| File | Purpose |
|:-----|:--------|
| `init/init-org.el` | Package bootstrap, babel languages, module loading |
| `config/mod-org.el` | Visual settings, TODOs, refile, archive, babel config |
| `config/mod-org-link.el` | Custom link types (crate, github, RFC), face overrides |
| `lisp/+clockreport.el` | Clock table formatting function |

## External Packages

| Package | Purpose |
|:--------|:--------|
| org | Core org-mode (from org package archive) |
| evil-org | Evil keybindings for org-mode |
| org-super-agenda | Group items in agenda |
| separedit | Edit comments/strings in dedicated buffer |
| org-modern | Visual enhancements (fold stars, block names) |
| org-cliplink | Create links from clipboard URLs |
| ox-gfm | GitHub-flavored markdown exporter |

## Behaviors

### Visual Settings

| Setting | Value |
|:--------|:------|
| `org-ellipsis` | ` …` (space + ellipsis) |
| `org-hide-emphasis-markers` | t |
| `org-pretty-entities` | t |
| `org-startup-folded` | nil |
| `org-startup-indented` | t |
| `org-startup-with-inline-images` | t |
| `org-indent-indentation-per-level` | 3 |
| `org-tags-column` | 0 |
| `org-fontify-quote-and-verse-blocks` | t |

### org-modern Configuration

| Setting | Value |
|:--------|:------|
| `org-modern-hide-stars` | nil |
| `org-modern-fold-stars` | Chevron pairs (▶/▼, ▹/▿, etc.) |
| `org-modern-block-name` | src/quote/example use ""/◌ |

Custom face for `org-modern-date-active` with distinct light/dark variants.

### TODO Keywords

```elisp
(type "TODO(t)" "WAIT(w)" "|" "DONE(d!)" "CANCELLED(c@)")
(type "PROJECT(p)" "|" "DONE(d!)")
```

| Setting | Value |
|:--------|:------|
| `org-use-fast-todo-selection` | expert |
| `org-enforce-todo-dependencies` | t |
| `org-enforce-todo-checkbox-dependencies` | t |
| `org-hierarchical-todo-statistics` | nil |
| `org-log-into-drawer` | t |

### Priority Faces

| Priority | Face |
|:---------|:-----|
| A | `error` |
| B | `warning` |
| C | `success` |

### Refile

| Setting | Value |
|:--------|:------|
| `org-refile-targets` | nil :maxlevel 3, org-agenda-files :maxlevel 3 |
| `org-refile-use-outline-path` | file |
| `org-outline-path-complete-in-steps` | nil |

Auto-save buffer after refile via `org-after-refile-insert-hook`.

### Archive

| Setting | Value |
|:--------|:------|
| `org-archive-location` | `{org-directory}/archive.org::datetree/` |
| `org-archive-subtree-add-inherited-tags` | t |

### Babel Languages

Enabled languages: emacs-lisp, C, calc, shell.

| Setting | Value |
|:--------|:------|
| `org-confirm-babel-evaluate` | nil |
| `org-edit-src-content-indentation` | 0 |
| `org-src-preserve-indentation` | nil |
| `org-src-window-setup` | plain |

Default header args:
- emacs-lisp: `:lexical "yes"`
- C: `:includes` for stdio, stdlib, stdint, etc.

### Source Block Mode Mappings

| Language | Mode |
|:---------|:-----|
| cs, csharp | csharp-ts |
| docker, dockerfile | dockerfile-ts |
| elixir | elixir-ts |
| json | json-ts |
| nix | nix-ts |
| rs, rust | rust-ts |
| sh | bash-ts |
| ts, typescript | typescript-ts |
| yaml, yml | yaml-ts |
| md | markdown |

### Export Settings

| Setting | Value |
|:--------|:------|
| `org-export-with-toc` | nil |
| `org-export-with-entities` | nil |

### Link Abbreviations

| Abbreviation | URL Template |
|:-------------|:-------------|
| github | `https://github.com/%s` |
| youtube | `https://youtube.com/watch?v=%s` |
| google | `https://google.com/search?q=` |
| wikipedia | `https://en.wikipedia.org/wiki/%s` |

### Custom Link Types

| Type | Follow Action | Export |
|:-----|:--------------|:-------|
| crate | Opens docs.rs | Links to crates.io |
| github | Opens GitHub repo | Links to GitHub |
| RFC | Opens RFC in rfc-mode buffer | Links to rfc-editor.org |

File links show `warning` face when target doesn't exist.

ID links use `+org-id-link` face (semi-bold, inherits font-lock-variable-name-face).

### Hooks

| Hook | Action |
|:-----|:-------|
| `org-mode-hook` | Enable abbrev-mode |
| `org-mode-hook` | Enable auto-fill-mode |
| `org-cycle-hook` | Hide drawers on cycle |
| `org-metareturn-hook` | Insert heading in lists |
| `org-log-buffer-setup-hook` | Enter evil insert state |
| `org-after-refile-insert-hook` | Save buffer |

### Evil Integration

Automatic evil insert state after:
- `org-insert-heading`
- `org-insert-heading-respect-content`
- `org-insert-todo-heading-respect-content`
- `org-insert-todo-heading`
- `org-capture` (when capture mode active)
- Log note buffer setup

### Clocking

| Setting | Value |
|:--------|:------|
| `org-clock-persist` | t |
| `org-duration-format` | h:mm |

Clock persistence initialized via transient hook on `org-mode-local-vars-hook`.

## Keybindings

### Global

| Key | Command |
|:----|:--------|
| `C-c a` | `org-agenda` |

### org-mode-map (Normal State)

| Key | Command |
|:----|:--------|
| `RET` | `org-open-at-point` |
| `M-p` | `org-metaup` |
| `M-n` | `org-metadown` |
| `C-c c` | `org-columns` |
| `C-c d` | `org-dynamic-block-insert-dblock` |
| `C-c n` | `org-next-link` |
| `C-c p` | `org-previous-link` |
| `C-c o` | `org-table-toggle-coordinate-overlays` |
| `SPC n s` | `org-narrow-to-subtree` |

### org-mode-map (Normal + Insert)

| Key | Command |
|:----|:--------|
| `C-c f` | `org-footnote-new` |
| `M-+` | `org-table-insert-column` |
| `M--` | `org-table-delete-column` |
| `C-c C-.` | `org-time-stamp-inactive` |
| `C-c .` | `org-time-stamp` |
| `C-c RET` | `org-insert-todo-heading` / `org-table-hline-and-move` |
| `C-c C-k` | Cut subtree / Cancel note / Capture kill |
| `C-c l` | `org-cliplink` |

### Local Leader (org-mode-map)

| Key | Command |
|:----|:--------|
| `A` | `org-archive-subtree` |
| `I` | `org-id-get-create` |
| `y` | `org-copy-subtree` |
| `x` | `org-cut-subtree` |
| `p` | `org-paste-subtree` |
| `t` | `org-show-todo-tree` |

### evil-org-agenda-mode-map (Motion)

| Key | Command |
|:----|:--------|
| `v` | `org-agenda-view-mode-dispatch` |
| `SPC` | nil (reserved for leader) |
| `/` | `org-agenda-filter` |

## API

### Functions

| Function | Purpose |
|:---------|:--------|
| `+clocktable-fmt-daily-log` | Custom clocktable formatter for daily logs |
| `+org-cut-subtree-or-cancel-note` | Context-aware cut/cancel |
| `+org-metareturn-insert-heading-insert-state-h` | Smart M-RET behavior |
| `+ad-org-enter-evil-insert-state` | Advice for insert state on heading creation |

### Variables

| Variable | Purpose |
|:---------|:--------|
| `abbrev-file-name` | Set to `{org-directory}/abbrev.el` |

### Faces

| Face | Purpose |
|:-----|:--------|
| `+org-id-link` | Distinct face for ID links |

## Testable Properties

1. `org-todo-keywords` includes TODO, WAIT, DONE, CANCELLED, PROJECT
2. `org-babel-load-languages` includes emacs-lisp, C, calc, shell
3. `org-archive-location` points to archive.org with datetree
4. File link to nonexistent path shows warning face
5. ID links use `+org-id-link` face
6. `org-modern-mode` is enabled globally
7. evil-org-mode activates in org-mode buffers
8. `org-super-agenda-mode` is enabled
9. `org-export-with-toc` is nil

## Dependencies

- Core: +corelib
- Completion: consult (for org-refile completion)
- Evil: evil, evil-org
- Help: rfc-mode (for RFC link type)
